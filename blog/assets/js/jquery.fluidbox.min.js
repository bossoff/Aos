!function(t,e,i,n){"use strict";function s(e,i){this.element=e;var n={};t.each(t(this.element).data(),function(t,e){var i,s=(i=t.replace("fluidbox",""))&&i[0].toLowerCase()+i.slice(1);(""!==s||null!==s)&&("false"==e?e=!1:"true"==e&&(e=!0),n[s]=e)}),this.settings=t.extend({},d,i,n),this.settings.viewportFill=Math.max(Math.min(parseFloat(this.settings.viewportFill),1),0),this.settings.stackIndex<this.settings.stackIndexDelta&&(settings.stackIndexDelta=settings.stackIndex),this._name=r,this.init()}var a=t(e),o=t(i),r="fluidbox",d={immediateOpen:!1,loader:!1,maxWidth:0,maxHeight:0,resizeThrottle:500,stackIndex:1e3,stackIndexDelta:10,viewportFill:.95},l={},c=0,f=function(){var t,e=i.createElement("fakeelement"),s={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in s)if(e.style[t]!==n)return s[t]}(),u={dom:function(){var e=t("<div />",{class:"fluidbox__wrap",css:{zIndex:this.settings.stackIndex-this.settings.stackIndexDelta}});if(t(this.element).addClass("fluidbox--closed").wrapInner(e).find("img").first().css({opacity:1}).addClass("fluidbox__thumb").after('<div class="fluidbox__ghost" />'),this.settings.loader){var i=t("<div />",{class:"fluidbox__loader",css:{zIndex:2}});t(this.element).find(".fluidbox__wrap").append(i)}},prepareFb:function(){var e=t(this.element);e.trigger("thumbloaddone.fluidbox"),u.measure.fbElements.call(this),this.bindEvents(),e.addClass("fluidbox--ready"),this.bindListeners(),e.trigger("ready.fluidbox")},measure:{viewport:function(){l.viewport={w:a.width(),h:a.height()}},fbElements:function(){var e=t(this.element),i=e.find("img").first(),n=e.find(".fluidbox__ghost"),s=e.find(".fluidbox__wrap");this.instanceData.thumb={natW:i[0].naturalWidth,natH:i[0].naturalHeight,w:i.width(),h:i.height()},n.css({width:i.width(),height:i.height(),top:i.offset().top-s.offset().top+parseInt(i.css("borderTopWidth"))+parseInt(i.css("paddingTop")),left:i.offset().left-s.offset().left+parseInt(i.css("borderLeftWidth"))+parseInt(i.css("paddingLeft"))})}},checkURL:function(t){var e=0;return/[\s+]/g.test(t)?(console.warn("Fluidbox: Fluidbox opening is halted because it has detected characters in your URL string that need to be properly encoded/escaped. Whitespace(s) have to be escaped manually. See RFC3986 documentation."),e=1):/[\"\'\(\)]/g.test(t)&&(console.warn("Fluidbox: Fluidbox opening will proceed, but it has detected characters in your URL string that need to be properly encoded/escaped. These will be escaped for you. See RFC3986 documentation."),e=0),e},formatURL:function(t){return t.replace(/"/g,"%22").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}};t.extend(s.prototype,{init:function(){var e=this,i=t(this.element),n=i.find("img").first();if(u.measure.viewport(),(!e.instanceData||!e.instanceData.initialized)&&i.is("a")&&1===i.children().length&&(i.children().is("img")||i.children().is("picture")&&1===i.find("img").length)&&"none"!==i.css("display")&&"none"!==i.children().css("display")&&"none"!==i.parents().css("display")){i.removeClass("fluidbox--destroyed"),e.instanceData={},e.instanceData.initialized=!0,e.instanceData.originalNode=i.html(),c+=1,e.instanceData.id=c,i.addClass("fluidbox__instance-"+c),i.addClass("fluidbox--initialized"),u.dom.call(e),i.trigger("init.fluidbox");var s=new Image;n.width()>0&&n.height()>0?u.prepareFb.call(e):(s.onload=function(){u.prepareFb.call(e)},s.onerror=function(){i.trigger("thumbloadfail.fluidbox")},s.src=n.attr("src"))}},open:function(){var e=this,i=t(this.element),n=i.find("img").first(),s=i.find(".fluidbox__ghost"),a=i.find(".fluidbox__wrap");e.instanceData.state=1,s.off(f),t(".fluidbox--opened").fluidbox("close");var o,r=t("<div />",{class:"fluidbox__overlay",css:{zIndex:-1}});if(a.append(r),i.removeClass("fluidbox--closed").addClass("fluidbox--loading"),u.checkURL(n.attr("src")))return e.close(),!1;s.css({"background-image":"url("+u.formatURL(n.attr("src"))+")",opacity:1}),u.measure.fbElements.call(e),e.settings.immediateOpen?(i.addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:e.settings.stackIndex+e.settings.stackIndexDelta}),i.trigger("openstart.fluidbox"),e.compute(),n.css({opacity:0}),t(".fluidbox__overlay").css({opacity:1}),s.one(f,function(){i.trigger("openend.fluidbox")}),(o=new Image).onload=function(){if(i.trigger("imageloaddone.fluidbox"),1===e.instanceData.state){if(e.instanceData.thumb.natW=o.naturalWidth,e.instanceData.thumb.natH=o.naturalHeight,i.removeClass("fluidbox--loading"),u.checkURL(o.src))return e.close({error:!0}),!1;s.css({"background-image":"url("+u.formatURL(o.src)+")"}),e.compute()}},o.onerror=function(){e.close({error:!0}),i.trigger("imageloadfail.fluidbox"),i.trigger("delayedloadfail.fluidbox")},o.src=i.attr("href")):((o=new Image).onload=function(){return i.trigger("imageloaddone.fluidbox"),i.removeClass("fluidbox--loading").addClass("fluidbox--opened fluidbox--loaded").find(".fluidbox__wrap").css({zIndex:e.settings.stackIndex+e.settings.stackIndexDelta}),i.trigger("openstart.fluidbox"),u.checkURL(o.src)?(e.close({error:!0}),!1):(s.css({"background-image":"url("+u.formatURL(o.src)+")"}),e.instanceData.thumb.natW=o.naturalWidth,e.instanceData.thumb.natH=o.naturalHeight,e.compute(),n.css({opacity:0}),t(".fluidbox__overlay").css({opacity:1}),void s.one(f,function(){i.trigger("openend.fluidbox")}))},o.onerror=function(){e.close({error:!0}),i.trigger("imageloadfail.fluidbox")},o.src=i.attr("href"))},compute:function(){var e,i,n,s=this,o=t(this.element),r=o.find("img").first(),d=o.find(".fluidbox__ghost"),c=o.find(".fluidbox__wrap"),f=s.instanceData.thumb.natW,u=s.instanceData.thumb.natH,p=s.instanceData.thumb.w,h=s.instanceData.thumb.h,g=f/u,b=l.viewport.w/l.viewport.h;s.settings.maxWidth>0?u=(f=s.settings.maxWidth)/g:s.settings.maxHeight>0&&(f=(u=s.settings.maxHeight)*g),b>g?(i=f*(h*(e=(u<l.viewport.h?u:l.viewport.h*s.settings.viewportFill)/h)/u)/p,n=e):(e=u*(p*(i=(f<l.viewport.w?f:l.viewport.w*s.settings.viewportFill)/p)/f)/h,n=i),s.settings.maxWidth&&s.settings.maxHeight&&console.warn("Fluidbox: Both maxHeight and maxWidth are specified. You can only specify one. If both are specified, only the maxWidth property will be respected. This will not generate any error, but may cause unexpected sizing behavior.");var x=a.scrollTop()-r.offset().top+h*(n-1)*.5+.5*(a.height()-h*n),m=p*(n-1)*.5+.5*(a.width()-p*n)-r.offset().left,v=parseInt(100*i)/100+","+parseInt(100*e)/100;d.css({transform:"translate("+parseInt(100*m)/100+"px,"+parseInt(100*x)/100+"px) scale("+v+")",top:r.offset().top-c.offset().top,left:r.offset().left-c.offset().left}),o.find(".fluidbox__loader").css({transform:"translate("+parseInt(100*m)/100+"px,"+parseInt(100*x)/100+"px) scale("+v+")"}),o.trigger("computeend.fluidbox")},recompute:function(){this.compute()},close:function(e){var i=this,s=t(this.element),a=s.find("img").first(),o=s.find(".fluidbox__ghost"),r=s.find(".fluidbox__wrap"),d=s.find(".fluidbox__overlay"),l=t.extend(null,{error:!1},e);return null!==i.instanceData.state&&typeof i.instanceData.state!=typeof n&&0!==i.instanceData.state&&(i.instanceData.state=0,s.trigger("closestart.fluidbox"),s.removeClass(function(t,e){return(e.match(/(^|\s)fluidbox--(opened|loaded|loading)+/g)||[]).join(" ")}).addClass("fluidbox--closed"),o.css({transform:"translate(0,0) scale(1,1)",top:a.offset().top-r.offset().top+parseInt(a.css("borderTopWidth"))+parseInt(a.css("paddingTop")),left:a.offset().left-r.offset().left+parseInt(a.css("borderLeftWidth"))+parseInt(a.css("paddingLeft"))}),s.find(".fluidbox__loader").css({transform:"none"}),o.one(f,function(){o.css({opacity:0}),a.css({opacity:1}),d.remove(),r.css({zIndex:i.settings.stackIndex-i.settings.stackIndexDelta}),s.trigger("closeend.fluidbox")}),l.error&&o.trigger("transitionend"),void d.css({opacity:0}))},bindEvents:function(){var e=this;t(this.element).on("click.fluidbox",function(t){t.preventDefault(),t.stopPropagation(),e.instanceData.state&&0!==e.instanceData.state?e.close():e.open()}),o.on("keydown",function(t){27===t.keyCode&&e.close()})},bindListeners:function(){var e=this,i=t(this.element),n=function(){u.measure.viewport(),u.measure.fbElements.call(e),i.hasClass("fluidbox--opened")&&e.compute()};t.isFunction(t.throttle)?a.on("resize.fluidbox"+e.instanceData.id,t.throttle(e.settings.resizeThrottle,n)):a.on("resize.fluidbox"+e.instanceData.id,n),i.on("reposition.fluidbox",function(){e.reposition()}),i.on("recompute.fluidbox, compute.fluidbox",function(){e.compute()}),i.on("destroy.fluidbox",function(){e.destroy()}),i.on("close.fluidbox",function(){e.close()})},unbind:function(){t(this.element).off("click.fluidbox reposition.fluidbox recompute.fluidbox compute.fluidbox destroy.fluidbox close.fluidbox"),a.off("resize.fluidbox"+this.instanceData.id)},reposition:function(){u.measure.fbElements.call(this)},destroy:function(){var e=this.instanceData.originalNode;this.unbind(),t.data(this.element,"plugin_"+r,null),t(this.element).removeClass(function(t,e){return(e.match(/(^|\s)fluidbox[--|__]\S+/g)||[]).join(" ")}).empty().html(e).addClass("fluidbox--destroyed").trigger("destroyed.fluidbox")},getMetadata:function(){return this.instanceData}}),t.fn[r]=function(e){var i,a=arguments;return e===n||"object"==typeof e?this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new s(this,e))}):"string"==typeof e&&"_"!==e[0]&&"init"!==e?(this.each(function(){var n=t.data(this,"plugin_"+r);n instanceof s&&"function"==typeof n[e]?i=n[e].apply(n,Array.prototype.slice.call(a,1)):console.warn('Fluidbox: The method "'+e+'" used is not defined in Fluidbox. Please make sure you are calling the correct public method.')}),i!==n?i:this):this}}(jQuery,window,document);